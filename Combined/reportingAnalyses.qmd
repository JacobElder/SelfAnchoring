---
title: "SelfAnchoring"
format: 
  html:
    toc: true
    html-math-method: katex
    css: styles.css
editor: visual
---

```{r, include=F}
library(groundhog)
library(pacman)

# pkgs <-  c("lmerTest", "ggeffects","r2glmm", "tidyverse","here", "sjPlot", "ggpubr", "wesanderson", "effectsize","broom.mixed","corrr","report", "ez", "ggdist")
# groundhog.day <- '2023-03-02'
# groundhog.library(pkgs, groundhog.day)

pacman::p_load("lmerTest", "ggeffects","r2glmm", "tidyverse","here", "sjPlot", "ggpubr", "wesanderson", "effectsize","broom.mixed","corrr","report", "ez", "ggdist", "gtsummary")

here::i_am("Combined/reportingAnalyses.qmd")

devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/corToOne.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/plotCommAxes.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/named.effects.ref.R")
```

# Study 1

```{r, include=F}
fullTest1 <- arrow::read_parquet(here("Study 1//Cleaning/output/fullTest.parquet"))
fullTrain1 <- arrow::read_parquet(here("Study 1/Cleaning/output/fullTrain.parquet"))

traitsFreqs1 <- read.csv(here("Study 1//Cleaning/output/traitFreqOverUnder.csv"))

uSubs <- unique(fullTest1$subID)

indDiffs1 <- fullTest1[!duplicated(fullTest1$subID),]
indDiffs1 <- indDiffs1 %>% select(subID, groupHomoph, DS:SING.Inter)
```

```{r, include=F}
fullTest1$ingChoiceN <- as.factor(fullTest1$ingChoiceN)
fullTest1$novel <- as.factor(fullTest1$novel)
fullTest1$selfResp.Z <- scale(fullTest1$selfResp)
fullTest1$SE.Z <- scale(fullTest1$SE)
fullTest1$iSE.Z <- scale(fullTest1$iSE)
fullTest1$oSE.Z <- scale(fullTest1$oSE)
fullTest1$predicted.Z <- scale(fullTest1$predicted)
fullTest1$slope.Z <- scale(fullTest1$slope)
fullTest1$entropy.Z <- scale(fullTest1$entropy)
fullTest1$WSR.Z <- scale(fullTest1$WSR)
fullTest1$neighAveOutSE.Z <- scale(fullTest1$neighAveOutSE)
fullTest1$neighAveAllSE.Z <- scale(fullTest1$neighAveAllSE)
fullTest1$neighAveInSE.Z <- scale(fullTest1$neighAveInSE)
fullTest1$evalLOO.Z <- scale(fullTest1$evalLOO)
fullTest1$propCorrLOO.Z <- scale(fullTest1$propCorrLOO)
fullTest1$propCorr.Z <- scale(fullTest1$propCorr)
fullTest1$desirability.Z <- scale(fullTest1$desirability)
fullTest1$er.Z <- scale(fullTest1$er)
fullTest1$outDegree.Z <- scale(fullTest1$outDegree)
fullTest1$inDegree.Z <- scale(fullTest1$inDegree)

fullTest1$novel <- as.factor(fullTest1$novel)
levels(fullTest1$novel) <- list("Trained"  = "0", "Held Out" = "1")

fullTrain1$metaContrastS <- log(fullTrain1$metaContrastS)
fullTrain1$metaContrastS.Z <- scale(fullTrain1$metaContrastS)
fullTrain1$inGsimS.Z <- scale(fullTrain1$inGsimS)
fullTrain1$outGsimS.Z <- scale(fullTrain1$outGsimS)
```

## **People Classify Desirable Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ desirability.Z +  ( desirability.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **People Classify Self-Descriptive Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **People Classify Similar-to-Self Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Do people use similarity-to-self for novel traits?

No difference between novel and observed traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

### Does effect of similarity-to-self differ depending on degree centrality?

No effect

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

Small but nonsignificant differences for higher indegree traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **Projection to the Ingroup, Rather than Rejection of the Outgroup**

### Metacontrast ratio (summed similarity to ingroup over summed similarity to outgroup) is strongly associated with self-descriptiveness

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z  + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain1)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### What are the relative contributions summed similarity to ingroup and summed similarity to outgroup?

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain1)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

## Correlates of Homophily in Group Classifications

```{r}
indDiffs1 %>% select(groupHomoph, DS:SING.Ind) %>% corToOne(., "groupHomoph")
indDiffs1 %>% select(groupHomoph, DS:SING.Ind) %>% plotCorToOne(., "groupHomoph")
```

## Computational Model

TBD

### Model Performance

### Parameter Recovery

### Parameter Correlations with Individual Differences

# Study 2

```{r, include = F}
fullTest2 <- arrow::read_parquet(here("Study 2//Cleaning/output/fullTest.parquet"))
fullTrain2 <- arrow::read_parquet(here("Study 2/Cleaning/output/fullTrain.parquet"))

traitsFreqs1 <- read.csv(here("Study 2//Cleaning/output/traitFreqOverUnder.csv"))

uSubs <- unique(fullTest2$subID)

indDiffs2 <- fullTest2[!duplicated(fullTest2$subID),]
```

```{r, include = F}
fullTest2$ingChoiceN <- as.factor(fullTest2$ingChoiceN)
fullTest2$novel <- as.factor(fullTest2$novel)
fullTest2$selfResp.Z <- scale(fullTest2$selfResp)
fullTest2$SE.Z <- scale(fullTest2$SE)
fullTest2$iSE.Z <- scale(fullTest2$iSE)
fullTest2$oSE.Z <- scale(fullTest2$oSE)
fullTest2$predicted.Z <- scale(fullTest2$predicted)
fullTest2$slope.Z <- scale(fullTest2$slope)
fullTest2$entropy.Z <- scale(fullTest2$entropy)
fullTest2$WSR.Z <- scale(fullTest2$WSR)
fullTest2$neighAveOutSE.Z <- scale(fullTest2$neighAveOutSE)
fullTest2$neighAveAllSE.Z <- scale(fullTest2$neighAveAllSE)
fullTest2$neighAveInSE.Z <- scale(fullTest2$neighAveInSE)
fullTest2$evalLOO.Z <- scale(fullTest2$evalLOO)
fullTest2$desirability.Z <- scale(fullTest2$desirability)
fullTest2$er.Z <- scale(fullTest2$er)
fullTest2$outDegree.Z <- scale(fullTest2$outDegree)
fullTest2$inDegree.Z <- scale(fullTest2$inDegree)

fullTest2$novel <- as.factor(fullTest2$novel)
levels(fullTest2$novel) <- list("Trained"  = "0", "Held Out" = "1")

fullTrain2$metaContrastS <- (fullTrain2$inGsimS/fullTrain2$outGsimS)
fullTrain2$metaContrastS <- log(fullTrain2$metaContrastS)
fullTrain2$metaContrastS[is.infinite(fullTrain2$metaContrastS)] <- NA
fullTrain2$metaContrastS.Z <- scale(fullTrain2$metaContrastS)
fullTrain2$inGsimS.Z <- scale(fullTrain2$inGsimS)
fullTrain2$outGsimS.Z <- scale(fullTrain2$outGsimS)

fullTest2$outgroup <- as.factor(fullTest2$outgroup)
fullTest2$outgroup <- relevel(fullTest2$outgroup,"Not UCR")

fullTrain2$outgroup <- as.factor(fullTrain2$outgroup)
fullTrain2$outgroup <- relevel(fullTrain2$outgroup,"Not UCR")

fullTest2$outgroupE <- named.effects.ref(fullTest2$outgroup, "Not UCR")
```

## **Differences Across Univerisities in Perceived Warmth and Status**

### Warmth

```{r, echo=F}
warmthDf <- pivot_longer(indDiffs2, cols=starts_with("Therm_"), names_to="University", values_to="Warmth") %>% select(subID, University, Warmth) %>% drop_na()
warmthDf$University <- gsub("Therm_1","UCR", warmthDf$University)
warmthDf$University <- gsub("Therm_2","UCLA", warmthDf$University)
warmthDf$University <- gsub("Therm_4","CSU LA", warmthDf$University)

warmthDf$University <- as.factor(warmthDf$University)
warmthDf$subID <- as.factor(warmthDf$subID)
warmthDf$University <- relevel(warmthDf$University, ref = "UCR")

m <- lmer( scale(Warmth) ~ University +  ( 1  | subID), data = warmthDf)
summary(m)
ggpredict(m, c("University")) %>% plot()

m<-ezANOVA(warmthDf, dv = Warmth, wid = subID, between = as.factor(University) )
m

indDiffs2$groupHomoph.Z <- scale(indDiffs2$groupHomoph)
ggplot(warmthDf, aes(University, Warmth)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Warmth",x="University") + jtools::theme_apa()
```

### Status

```{r, echo=F}
indDiffs2$Status <- NULL
statusDf <- pivot_longer(indDiffs2, cols=ends_with("_Status"), names_to="University", values_to="Status") %>% select(subID, University, Status) %>% drop_na()
statusDf$University <- gsub("_Status","", statusDf$University)

statusDf$University <- as.factor(statusDf$University)
statusDf$subID <- as.factor(statusDf$subID)
statusDf$University <- relevel(statusDf$University, ref = "UCR")

m <- lmer( scale(Status) ~ University +  ( 1  | subID), data = statusDf)
summary(m)
ggpredict(m, c("University")) %>% plot()

m<-ezANOVA(statusDf, dv = Status, wid = subID, between = as.factor(University) )
m

ggplot(statusDf, aes(University, Status)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Status",x="University") + jtools::theme_apa()
```

## **People Classify Desirable Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ desirability.Z +  ( desirability.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ desirability.Z * outgroup +  ( desirability.Z | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **People Classify Self-Descriptive Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z * outgroup +  ( selfResp.Z | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **People Classify Similar-to-Self Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Do people use similarity-to-self for novel traits?

No difference between novel and observed traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

#### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel * outgroup + ( WSR.Z + novel | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

### Does effect of similarity-to-self differ depending on degree centrality?

No effect

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

Small but nonsignificant differences for higher indegree traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **Projection to the Ingroup, Rather than Rejection of the Outgroup**

### Metacontrast ratio (summed similarity to ingroup over summed similarity to outgroup) is strongly associated with self-descriptiveness

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z  + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain2)
summary(m)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### Metacontrast ratio compared across condition

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z * outgroup  + (  metaContrastS.Z | subID) + ( outgroup | trait), data = fullTrain2)
summary(m)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### What are the relative contributions summed similarity to ingroup and summed similarity to outgroup?

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * outgroup + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain2)
summary(m)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### Summed Similarity to Ingroup Compared Across Conditions

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * outgroup + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + ( outgroup | trait), data = fullTrain2)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### Summed Similarity to Outgroup Compared Across Conditions

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z + outGsimS.Z * outgroup + (  inGsimS.Z + outGsimS.Z | subID) + ( outgroup | trait), data = fullTrain2)
summary(m)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

## Correlates of Homophily in Group Classifications

```{r}
indDiffs2 %>% select(groupHomoph, seHomoph, SStatus:IdImp) %>% corToOne(., "groupHomoph")
indDiffs2 %>% select(groupHomoph, seHomoph, SStatus:IdImp) %>% plotCorToOne(., "groupHomoph")
```

## Computational Model

TBD

### Model Performance

### Parameter Recovery

### Parameter Correlations with Individual Differences

# Study 3

```{r, include = F}
fullTest3 <- arrow::read_parquet(here("Study 3//Cleaning/output/fullTest.parquet"))
fullTrain3 <- arrow::read_parquet(here("Study 3/Cleaning/output/fullTrain.parquet"))

uSubs <- unique(fullTest3$subID)

indDiffs3 <- fullTest3[!duplicated(fullTest3$subID),]
```

```{r, include = F}
fullTest3$ingChoiceN <- as.factor(fullTest3$ingChoiceN)
fullTest3$novel <- as.factor(fullTest3$novel)
fullTest3$selfResp.Z <- scale(fullTest3$selfResp)
fullTest3$SE.Z <- scale(fullTest3$SE)
fullTest3$iSE.Z <- scale(fullTest3$iSE)
fullTest3$oSE.Z <- scale(fullTest3$oSE)
fullTest3$predicted.Z <- scale(fullTest3$predicted)
fullTest3$slope.Z <- scale(fullTest3$slope)
fullTest3$entropy.Z <- scale(fullTest3$entropy)
fullTest3$WSR.Z <- scale(fullTest3$WSR)
fullTest3$neighAveOutSE.Z <- scale(fullTest3$neighAveOutSE)
fullTest3$neighAveAllSE.Z <- scale(fullTest3$neighAveAllSE)
fullTest3$neighAveInSE.Z <- scale(fullTest3$neighAveInSE)
fullTest3$evalLOO.Z <- scale(fullTest3$evalLOO)
fullTest3$desirability.Z <- scale(fullTest3$desirability)
fullTest3$er.Z <- scale(fullTest3$er)
fullTest3$outDegree.Z <- scale(fullTest3$outDegree)
fullTest3$inDegree.Z <- scale(fullTest3$inDegree)

fullTest3$novel <- as.factor(fullTest3$novel)
levels(fullTest3$novel) <- list("Trained"  = "0", "Held Out" = "1")

fullTrain3$metaContrastS <- (fullTrain3$inGsimS/fullTrain3$outGsimS)
fullTrain3$metaContrastS <- log(fullTrain3$metaContrastS)
fullTrain3$metaContrastS[is.infinite(fullTrain3$metaContrastS)] <- NA
fullTrain3$metaContrastS.Z <- scale(fullTrain3$metaContrastS)
fullTrain3$inGsimS.Z <- scale(fullTrain3$inGsimS)
fullTrain3$outGsimS.Z <- scale(fullTrain3$outGsimS)

fullTest3$condition <- as.factor(fullTest3$condition)
fullTest3$condition <- relevel(fullTest3$condition,"Majority")

fullTrain3$condition <- as.factor(fullTrain3$condition)
fullTrain3$condition <- relevel(fullTrain3$condition,"Majority")
```

## **Differences Across Univerisities in Perceived Warmth and Status**

### Warmth

```{r, echo=F}
warmthDf <- pivot_longer(indDiffs3, cols=starts_with("Therm_"), names_to="Group", values_to="Warmth") %>% select(subID, Group, Warmth) %>% drop_na()
warmthDf$Group <- gsub("Therm_1","White", warmthDf$Group)
warmthDf$Group <- gsub("Therm_2","Asian", warmthDf$Group)
warmthDf$Group <- gsub("Therm_4","Latino", warmthDf$Group)

warmthDf$Group <- as.factor(warmthDf$Group)
warmthDf$subID <- as.factor(warmthDf$subID)
warmthDf$Group <- relevel(warmthDf$Group, ref = "White")

m <- lmer( scale(Warmth) ~ Group +  ( 1  | subID), data = warmthDf)
summary(m)
ggpredict(m, c("Group")) %>% plot()

m<-ezANOVA(warmthDf, dv = Warmth, wid = subID, between = as.factor(Group) )
m

ggplot(warmthDf, aes(Group, Warmth)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Warmth",x="University") + jtools::theme_apa()
```

### Status

```{r, echo=F}
indDiffs3$Status <- NULL
statusDf <- pivot_longer(indDiffs3, cols=ends_with("_Status"), names_to="Group", values_to="Status") %>% select(subID, Group, Status) %>% drop_na()
statusDf$Group <- gsub("_Status","", statusDf$Group)

statusDf$Group <- as.factor(statusDf$Group)
statusDf$subID <- as.factor(statusDf$subID)
statusDf$Group <- relevel(statusDf$Group, ref = "White")

m <- lmer( scale(Status) ~ Group +  ( 1  | subID), data = statusDf)
summary(m)
ggpredict(m, c("Group")) %>% plot()

m<-ezANOVA(statusDf, dv = Status, wid = subID, between = as.factor(Group) )
m

ggplot(statusDf, aes(Group, Status)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Status",x="University") + jtools::theme_apa()
```

## **People Classify Desirable Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ desirability.Z +  ( desirability.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ desirability.Z * condition +  ( desirability.Z | subID) + ( condition | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **People Classify Self-Descriptive Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z * condition +  ( selfResp.Z | subID) + ( condition | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **People Classify Similar-to-Self Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * condition + ( WSR.Z | subID) + ( condition | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

### Do people use similarity-to-self for novel traits?

No difference between novel and observed traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

#### Similarity-to-self compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel * condition + ( WSR.Z + novel | subID) + ( condition | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

### Does effect of similarity-to-self differ depending on degree centrality?

No effect

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

Small but nonsignificant differences for higher indegree traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

## **Projection to the Ingroup, Rather than Rejection of the Outgroup**

### Metacontrast ratio (summed similarity to ingroup over summed similarity to outgroup) is strongly associated with self-descriptiveness

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z  + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### Metacontrast ratio compared across condition

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z * condition  + (  metaContrastS.Z | subID) + ( condition | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### What are the relative contributions summed similarity to ingroup and summed similarity to outgroup?

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * condition + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### Summed Similarity to Ingroup Compared Across Conditions

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * condition + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + ( outgroup | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### Summed Similarity to Outgroup Compared Across Conditions

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z + outGsimS.Z * condition + (  inGsimS.Z + outGsimS.Z | subID) + ( condition | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

## Correlates of Homophily in Group Classifications

```{r}
indDiffs3 %>% select(groupHomoph, seHomoph, SStatus, SocClass, SCC:IdImp) %>% corToOne(., "groupHomoph")
indDiffs3 %>% select(groupHomoph, seHomoph, SStatus, SocClass, SCC:IdImp) %>% plotCorToOne(., "groupHomoph")
```

## Computational Model

TBD

### Model Performance

### Parameter Recovery

### Parameter Correlations with Individual Differences

# 
