---
title: "Self-Anchoring Study 2 Analyses"
output:
  html_document:
    df_print: paged
  toc: true
---

```{r}
library(groundhog)
pkgs <-  c("lmerTest", "ggeffects","r2glmm", "tidyverse","here", "sjPlot", "ggpubr", "wesanderson", "effectsize","broom.mixed","corrr","report", "ez", "ggdist")
groundhog.day <- '2022-07-25'
groundhog.library(pkgs, groundhog.day)
here::i_am("Study 2/Analysis/SAs2_Analysis.Rmd")
#plotDir <- "/Volumes/Research Project/Trait_TestRetest/WeekTRT/plots/"
```

```{r}
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/corToOne.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/plotCommAxes.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/named.effects.ref.R")
```


```{r}
# fullTest <- read.csv("../Cleaning/output/fullTest.csv")
# fullTrain <- read.csv("../Cleaning/output/fullTrain.csv")
# traitsFreqs <- read.csv("../Cleaning/output/traitFreqOverUnder.csv")

fullTest <- arrow::read_parquet("../Cleaning/output/fullTest.parquet")
fullTrain <- arrow::read_parquet("../Cleaning/output/fullTrain.parquet")
traitsFreqs <- arrow::read_parquet("../Cleaning/output/traitFreqOverUnder.parquet")

uSubs <- unique(fullTest$subID)

indDiffs <- fullTest[!duplicated(fullTest$subID),]

allPosCents <- read.csv("/Volumes/GoogleDrive/My Drive/Volumes/Research Project/Trait Network_Behaviral/generating network/output/allPosCents.csv")
```

```{r}
fullTest$ingChoiceN <- as.factor(fullTest$ingChoiceN)
fullTest$novel <- as.factor(fullTest$novel)
fullTest$selfResp.Z <- scale(fullTest$selfResp)
fullTest$SE.Z <- scale(fullTest$SE)
fullTest$iSE.Z <- scale(fullTest$iSE)
fullTest$oSE.Z <- scale(fullTest$oSE)
fullTest$predicted.Z <- scale(fullTest$predicted)
fullTest$slope.Z <- scale(fullTest$slope)
fullTest$entropy.Z <- scale(fullTest$entropy)
fullTest$WSR.Z <- scale(fullTest$WSR)
fullTest$neighAveOutSE.Z <- scale(fullTest$neighAveOutSE)
fullTest$neighAveAllSE.Z <- scale(fullTest$neighAveAllSE)
fullTest$neighAveInSE.Z <- scale(fullTest$neighAveInSE)
fullTest$evalLOO.Z <- scale(fullTest$evalLOO)
fullTest$propCorrInLOO.Z <- scale(fullTest$propCorrInLOO)
fullTest$propCorrOutLOO.Z <- scale(fullTest$propCorrOutLOO)
#fullTest$propCorr.Z <- scale(fullTest$propCorr)
fullTest$desirability.Z <- scale(fullTest$desirability)
fullTest$er.Z <- scale(fullTest$er)
fullTest$inDegree.Z <- scale(fullTest$inDegree)
fullTest$outDegree.Z <- scale(fullTest$outDegree)
fullTest$Ent.Z <- scale(fullTest$Ent)

fullTest$outgroup <- as.factor(fullTest$outgroup)
fullTest$outgroup <- relevel(fullTest$outgroup,"Not UCR")

fullTest$outgroupE <- named.effects.ref(fullTest$outgroup, "Not UCR")

mat = matrix(c(1/3, 1/3, 1/3, -.5, 1, -.5, -.5, -.5, 1), nrow = 3)
mymat = solve(t(mat))
mymat
#remove the intercept (constant) term
my.contrasts<-mymat[,2:3]
colnames(my.contrasts) <- c("CSULA-Other", "UCLA-Other")
fullTest$outgroupU <- fullTest$outgroup
contrasts(fullTest$outgroupU) = my.contrasts


mycontrasts2 = contrasts(fullTest$outgroup)
mycontrasts2[,1] = c(-1/2, -1/2, 1)
mycontrasts2[,2] = c(-1/2, 1, -1/2)
contrasts(fullTest$outgroupU) = mycontrasts2
```

```{r}
fullTest$OtherTherm <- rowMeans(fullTest[c("Therm_2","Therm_4")])
fullTest$InOtherTherm <- fullTest$Therm_1 - fullTest$OtherTherm
fullTest$OtherStatus <- rowMeans(fullTest[c("UCLA_Status","CSULA_Status")])
fullTest$InOtherStatus <- fullTest$UCR_Status - fullTest$OtherStatus

fullTest$InOutStatus <- ifelse(fullTest$outgroup == "UCLA", fullTest$InUCLAStatus, 
       ifelse(fullTest$outgroup == "CSU LA", fullTest$InCSULAStatus,
              ifelse(fullTest$outgroup == "Not UCR", fullTest$InOtherStatus, NA)))
fullTest$InOutTherm <- ifelse(fullTest$outgroup == "UCLA", fullTest$InUCLATherm, 
       ifelse(fullTest$outgroup == "CSU LA", fullTest$InCSULATherm,
              ifelse(fullTest$outgroup == "Not UCR", fullTest$InOtherTherm, NA)))
```



```{r}
fullTest$novel <- as.factor(fullTest$novel)
levels(fullTest$novel) <- list("Trained"  = "0", "Held Out" = "1")

fullTest$outgroup <- as.factor(fullTest$outgroup)
fullTest$outgroup <- relevel(fullTest$outgroup,"Not UCR")
```

```{r}
PCA<- prcomp(na.omit(fullTest[c("predicted","neighAveOutSE")]),
                center = TRUE,
                scale. = TRUE)
fullTest$PCA[!is.na(fullTest$predicted) & !is.na(fullTest$neighAveOutSE)] <- PCA$x[,1]
```


```{r}
propMatrix <- matrix(nrow=148,ncol=7)
for(i in 1:148){
    traitDf <- subset(fullTest, Idx==i)
    test <- t.test(as.numeric(traitDf$ingChoiceN)-1, mu=.50)
    propMatrix[i, ] <- c(i, test$statistic, test$p.value, test$conf.int, test$estimate, test$parameter)
}
colnames(propMatrix) <- c("Idx", "stat", "p", "LCI", "UCI", "est", "param")
propMatrix <- as.data.frame(propMatrix)
propMatrix$trait <- traitsFreqs$trait[1:148]
propMatrix <- propMatrix[order(propMatrix$p),]

propMatrix
```

# Are there differences in the perceptions of status between universities?

UCR students perceive UCLA as being significantly higher status and CSU LA students as being significantly lower status.

```{r}
indDiffs$Status <- NULL
statusDf <- pivot_longer(indDiffs, cols=ends_with("_Status"), names_to="University", values_to="Status") %>% select(subID, University, Status) %>% drop_na()
statusDf$University <- gsub("_Status","", statusDf$University)

statusDf$University <- as.factor(statusDf$University)
statusDf$subID <- as.factor(statusDf$subID)
statusDf$University <- relevel(statusDf$University, ref = "UCR")

m <- lmer( scale(Status) ~ University +  ( 1  | subID), data = statusDf)
summary(m)
ggpredict(m, c("University")) %>% plot()

m<-ezANOVA(statusDf, dv = Status, wid = subID, between = as.factor(University) )
m

ggplot(statusDf, aes(University, Status)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Status",x="University") + jtools::theme_apa()
```

# Do people feel differ in how warmly they feel towards each university?

UCR students feel the most warmth towards UCR, significantly less towards UCLA, and the least towards CSU LA.

```{r}
warmthDf <- pivot_longer(indDiffs, cols=starts_with("Therm_"), names_to="University", values_to="Warmth") %>% select(subID, University, Warmth) %>% drop_na()
warmthDf$University <- gsub("Therm_1","UCR", warmthDf$University)
warmthDf$University <- gsub("Therm_2","UCLA", warmthDf$University)
warmthDf$University <- gsub("Therm_4","CSU LA", warmthDf$University)

warmthDf$University <- as.factor(warmthDf$University)
warmthDf$subID <- as.factor(warmthDf$subID)
warmthDf$University <- relevel(warmthDf$University, ref = "UCR")

m <- lmer( scale(Warmth) ~ University +  ( 1  | subID), data = warmthDf)
summary(m)
ggpredict(m, c("University")) %>% plot()

m<-ezANOVA(warmthDf, dv = Warmth, wid = subID, between = as.factor(University) )
m

indDiffs$groupHomoph.Z <- scale(indDiffs$groupHomoph)
ggplot(warmthDf, aes(University, Warmth)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Warmth",x="University") + jtools::theme_apa()
```

# Correlates with Assortativity in Group Predictioons

Dialectical self and need to belong positively associated with group assortativity. Social identification, self-esteem, identity-centrality, public collectivr eself-est

```{r}
indDiffs %>% select(groupHomoph, seHomoph, SStatus:IdImp) %>% corToOne(., "groupHomoph")
indDiffs %>% select(groupHomoph, seHomoph, SStatus:IdImp) %>% plotCorToOne(., "groupHomoph")
```

# Differences in assortativity of group predictions

```{r}
library(ez)
m<-ezANOVA(indDiffs[!is.na(indDiffs$groupHomoph),], dv=groupHomoph, wid=subID, between=outgroup)
hsd <- TukeyHSD(aov(groupHomoph ~ outgroup, data=indDiffs[!is.na(indDiffs$groupHomoph),]))
print(m)
print(hsd)
ezPlot(indDiffs[!is.na(indDiffs$groupHomoph),], groupHomoph, wid=subID, between=outgroup, x=.(outgroup))

indDiffs$groupHomoph.Z <- scale(indDiffs$groupHomoph)
m <- lm(groupHomoph.Z ~ outgroup, data=indDiffs)
summary(m)
ggpredict(m, c("outgroup")) %>% plot(show.title=F, add.data=T)

ggplot(indDiffs, aes(outgroup, groupHomoph.Z)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3)  + labs(y="Homophily",x="University Comparison") + jtools::theme_apa()
```


# (Attempt to) replicate prior work: Ingroup favoritism exhibited by ascribing more positive traits to ingroup

Desirability predicts ingroup predictions.

```{r}
m <- glmer( ingChoiceN ~ desirability.Z +  ( desirability.Z  | subID) + ( 1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

Desirability predicts ingroup predictions most strongly for not CSU LA, less so for UCLA, and least for CSU LA.

```{r}
m <- glmer( ingChoiceN ~ desirability.Z * outgroup +  ( desirability.Z  | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("desirability.Z","outgroup")) %>% plot(show.title=F) + xlab("Desirability") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

# Replication of prior self-anchoring findings: Self-evaluations predicting ingroup evaluations

## Zero-Order Effect

Self-descriptiveness predict ingroup predictions

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z  +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Zero-Order Effect, depending on Outgroup Comparison

Self-descriptiveness predict ingroup predictions

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z * outgroup * novel  +  ( selfResp.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("selfResp.Z", "outgroup")) %>% plot(show.title=F) + xlab("Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## With covariates

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z  + desirability.Z +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## With desirability covariates and differences with outgroup

Self-evaluations are more predictive of ingroup choices for negation and least predictive for CSU LA.

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z * outgroup + desirability.Z +  ( selfResp.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("selfResp.Z", "outgroup")) %>% plot(show.title=F) + xlab("Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

# Is it merely just average self-descriptiveness of the trait?

Even while controlling for the average of all other participants' evaluations on each trait, participants' evaluations are still predictive of ingroup predictions.

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z + evalLOO.Z + desirability.Z +  ( evalLOO.Z + selfResp.Z + desirability.Z | subID) + ( 1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Does similarity-weighted self-evaluation average predict ingroup choices?

## Zero-Order Effect

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Zero-Order Effect, depending on Outgroup Comparison (Negation is Ref)

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z","outgroup")) %>% plot()
```

## Zero-Order Effect, depending on Outgroup Comparison (Effects Coded)

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroupE + ( WSR.Z | subID) + ( outgroupE | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z","outgroupE","novel")) %>% plot()
```

## Zero-Order Effect, depending on Outgroup Comparison (UCLA v. Other, CSULA v. Other)

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroupU + ( WSR.Z | subID) + ( outgroupU | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z","outgroupU")) %>% plot()
```


## Covariates

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + desirability.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Covariates and Condition Differences

Similarity-wieghted self-evaluations predict later ingroup endorsements most for those with UCLA comparison and least for those with CSU LA comparison.

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroupU + desirability.Z + ( WSR.Z + desirability.Z | subID) + ( outgroupU | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
p <- ggpredict(m, c("WSR.Z","outgroupU"))
Sim.Condition.Plot <-ggplot(p, aes(x, predicted)) +  geom_line(aes(linetype=group, color=group)) + geom_ribbon(aes(ymin=conf.low, ymax=conf.high, fill=group), alpha=0.15) + scale_linetype_discrete(labels = c("Not UCR","CSU LA", "UCLA")) + scale_color_manual(labels = c("Not UCR","CSU LA", "UCLA"), values = wes_palette("Darjeeling1")) + scale_fill_manual( 
                      labels=c("Not UCR","CSU LA", "UCLA"), values = wes_palette("Darjeeling1")) + theme(
    legend.position = c(.1, .65),
    legend.justification = c("left", "bottom"),
    legend.box.just = "left",
    legend.margin = margin(6, 6, 6, 6)
    ) + theme(axis.text=element_text(size=12),
        axis.title=element_text(size=12,face="bold")) + theme(legend.text = element_text(size=12)) + theme(panel.border = element_rect(colour = "black", fill = NA, size =1)) + theme(legend.title = element_blank()) + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black")) +
  xlab("Similarity-to-Self") + ylab("Probability of Ingroup Classification")
Sim.Condition.Plot
```

#### UCR Status

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * UCR_Status + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","UCR_Status","outgroup")) %>% plot()
```


#### Identity Importance

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * IdImp + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","IdImp","outgroup")) %>% plot()
```

#### Self-Esteem

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(RSE) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","RSE","outgroup")) %>% plot()
```

### Need to Belong

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(NTB) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","NTB","outgroup")) %>% plot()
```

## Multidimensional Ingroup Identification

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(MGIS) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","MGIS","outgroup")) %>% plot()
```

## Interdependent Self-Construal

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(SING.Inter) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","SING.Inter","outgroup")) %>% plot()
```

## Entitativity

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(Ent) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","Ent","outgroup")) %>% plot()
```

## Self-Prototypicality

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(Proto) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","Proto","outgroup")) %>% plot()
```

## Need for Cognition

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(NFC) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","NFC","outgroup")) %>% plot()
```

## Group Similarity

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(GSim) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","NFC","outgroup")) %>% plot()
```

## Group Homophily

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup * scale(groupHomoph) + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
summary(m)
ggpredict(m, c("WSR.Z","groupHomoph","outgroup")) %>% plot()
```

```{r}
# fullTest$outgroupP <- factor(fullTest$outgroup, levels = c("CSU LA", "Not UCR", "UCLA"))
# contrasts(fullTest$outgroupP) <- contr.poly(3)
# m <- glmer( ingChoiceN ~ WSR.Z * outgroupP + desirability.Z + evalLOO.Z + ( WSR.Z | subID) + ( outgroupP | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
#                                     optCtrl = list(maxfun = 100000)),
#     nAGQ = 1)
# tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
# ggpredict(m, c("WSR.Z", "outgroup")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Evaluations") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

# Do cross-validation predictions predict ingroup choices?

## No covariates

```{r}
m <- glmer( ingChoiceN ~ predicted.Z + ( predicted.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## With covariates

```{r}
m <- glmer( ingChoiceN ~ predicted.Z + desirability.Z +  ( predicted.Z | subID) + ( 1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Covariates and Condition Differences

No effect

```{r}
m <- glmer( ingChoiceN ~ predicted.Z*outgroup + desirability.Z + ( predicted.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("predicted.Z", "outgroup")) %>% plot(show.title=F) + xlab("Cross-Validated Expectations") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

# Does dot-product expected ratings predict ingroup choices?

## No covariates

```{r}
m <- glmer( ingChoiceN ~ er.Z + ( er.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## With covariates

```{r}
m <- glmer( ingChoiceN ~ er.Z + desirability.Z +  ( er.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Covariates and Condition Differences

Marginall difference in CSU LA compared to Not UCR such that effect of expected ratings is slightly stronger on ingroup choices.

```{r}
m <- glmer( ingChoiceN ~ er.Z*outgroup + desirability.Z + ( er.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("er.Z", "outgroup")) %>% plot(show.title=F) + xlab("Dot-Product Expected Rating") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

# Does the linear trend of self-descriptiveness predict ingroup choices?

## No covariates

```{r}
m <- glmer( ingChoiceN ~ slope.Z + ( slope.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## With covariates

```{r}
m <- glmer( ingChoiceN ~ slope.Z + desirability.Z +  ( slope.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Covariates and Condition Differences

Effect of self-descriptiveness trend is greatest for UCLA and weakest for CSU LA

```{r}
m <- glmer( ingChoiceN ~ slope.Z*outgroup + desirability.Z + ( slope.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("slope.Z", "outgroup")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Evaluations") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

# Do the neighboring self-evaluations predict ingroup choices?

## All neighbors

### No covariates

```{r}
m <- glmer( ingChoiceN ~ neighAveAllSE.Z + ( neighAveAllSE.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

### With covariates

```{r}
m <- glmer( ingChoiceN ~ neighAveAllSE.Z + desirability.Z +  ( neighAveAllSE.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

### Covariates and Condition Differences

Effect of neighboring self-evaluations on ingroup choices is strongest for UCLA and weakest for CSU LA

```{r}

m <- glmer( ingChoiceN ~ neighAveAllSE.Z*outgroup + desirability.Z + ( neighAveAllSE.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("neighAveAllSE.Z", "outgroup")) %>% plot(show.title=F) + xlab("Neighbors' Average Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## All neighbors

### No covariates

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z + ( neighAveOutSE.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

### With covariates

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z + desirability.Z +  ( neighAveOutSE.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

### Covariates and Condition Differences

Effect of neighboring self-evaluations on ingroup choices is strongest for UCLA and weakest for CSU LA

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z*outgroup + desirability.Z + ( neighAveOutSE.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("neighAveOutSE.Z", "outgroup")) %>% plot(show.title=F) + xlab("Outwards Neighbors' Average Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## Indegree neighbors

### No covariates

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z + ( neighAveInSE.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

### With covariates

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z + desirability.Z +  ( neighAveInSE.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

### Covariates and Condition Differences

Effect of neighboring self-evaluations on ingroup choices is strongest for UCLA and weakest for CSU LA

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z*outgroup + desirability.Z + ( neighAveInSE.Z | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("neighAveInSE.Z", "outgroup")) %>% plot(show.title=F) + xlab("Inwards Neighbors' Average Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

# Do people self-anchor more for higher indegree traits?

## Similarity-Weighted Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * inDegree.Z + desirability.Z + ( WSR.Z + inDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z", "inDegree.Z")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## Cross-Validated Expectations

```{r}
m <- glmer( ingChoiceN ~ predicted.Z * inDegree.Z + desirability.Z + ( predicted.Z + inDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Dot-Product Expected Ratings

```{r}
m <- glmer( ingChoiceN ~ er.Z * inDegree.Z + desirability.Z + ( er.Z + inDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Linear Trend of Self-Descriptiveness

```{r}
m <- glmer( ingChoiceN ~ slope.Z * inDegree.Z + desirability.Z + ( slope.Z + inDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## All Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveAllSE.Z * inDegree.Z + desirability.Z + ( neighAveAllSE.Z + inDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Outwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z * inDegree.Z + desirability.Z + ( neighAveOutSE.Z + inDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Inwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z * inDegree.Z + desirability.Z + ( neighAveInSE.Z + inDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Do people self-anchor more for higher outdegree traits?

## Similarity-Weighted Self-Evaluations

Similarity-weighted self-descriptiveness more predictive of ingroup choices for higher outdegree traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outDegree.Z + desirability.Z + ( WSR.Z + outDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z", "outDegree.Z")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## Cross-Validated Expectations

```{r}
m <- glmer( ingChoiceN ~ predicted.Z * outDegree.Z + desirability.Z + ( predicted.Z + outDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Dot-Product Expected Ratings

```{r}
m <- glmer( ingChoiceN ~ er.Z * outDegree.Z + desirability.Z + ( er.Z + outDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Linear Trend of Self-Descriptiveness

```{r}
m <- glmer( ingChoiceN ~ slope.Z * outDegree.Z + desirability.Z + ( slope.Z + outDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## All Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveAllSE.Z * outDegree.Z + desirability.Z + ( neighAveAllSE.Z + outDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Outwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z * outDegree.Z + desirability.Z + ( neighAveOutSE.Z + outDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Inwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z * outDegree.Z + desirability.Z + ( neighAveInSE.Z + outDegree.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Do cross-validated similarity * self-evaluation predictions predict ingroup choices, regardless of whether it was seen prior or not?

## Similarity-Weighted Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel + desirability.Z + ( WSR.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z", "novel")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

### Moderated by outgroup comparison

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel * outgroup + desirability.Z + ( WSR.Z + novel | subID) + ( outgroup | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z", "novel", "outgroup")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## Cross-Validated Expectations

```{r}
m <- glmer( ingChoiceN ~ predicted.Z * novel + desirability.Z + ( predicted.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Dot-Product Expected Ratings

```{r}
m <- glmer( ingChoiceN ~ er.Z * novel + desirability.Z + ( er.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Linear Trend of Self-Descriptiveness

```{r}
m <- glmer( ingChoiceN ~ slope.Z * novel + desirability.Z + ( slope.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## All Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveAllSE.Z * novel + desirability.Z + ( neighAveAllSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Outwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z * novel + desirability.Z + ( neighAveOutSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Inwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z * novel + desirability.Z + ( neighAveInSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Does generalization depend on outdegree?

## Similarity-Weighted Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel * outDegree.Z + desirability.Z + ( WSR.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z", "novel")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## Cross-Validated Expectations

```{r}
m <- glmer( ingChoiceN ~ predicted.Z * novel * outDegree.Z + desirability.Z + ( predicted.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Dot-Product Expected Ratings

```{r}
m <- glmer( ingChoiceN ~ er.Z * novel * outDegree.Z + desirability.Z + ( er.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Linear Trend of Self-Descriptiveness

```{r}
m <- glmer( ingChoiceN ~ slope.Z * novel * outDegree.Z + desirability.Z + ( slope.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## All Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveAllSE.Z * novel * outDegree.Z + desirability.Z + ( neighAveAllSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Outwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z * novel * outDegree.Z + desirability.Z + ( neighAveOutSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Inwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z * novel * outDegree.Z + desirability.Z + ( neighAveInSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Does generalization depend on indegree?

## Similarity-Weighted Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel * inDegree.Z + desirability.Z + ( WSR.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("WSR.Z", "novel")) %>% plot(show.title=F) + xlab("Similarity-Weighted Self-Descriptiveness") + ylab("Likelihood of Ingroup Choice") + jtools::theme_apa()
```

## Cross-Validated Expectations

```{r}
m <- glmer( ingChoiceN ~ predicted.Z * novel * inDegree.Z + desirability.Z + ( predicted.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Dot-Product Expected Ratings

```{r}
m <- glmer( ingChoiceN ~ er.Z * novel * inDegree.Z + desirability.Z + ( er.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Linear Trend of Self-Descriptiveness

```{r}
m <- glmer( ingChoiceN ~ slope.Z * novel * inDegree.Z + desirability.Z + ( slope.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## All Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveAllSE.Z * novel * inDegree.Z + desirability.Z + ( neighAveAllSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Outwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveOutSE.Z * novel * inDegree.Z + desirability.Z + ( neighAveOutSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Inwards Neighboring Self-Evaluations

```{r}
m <- glmer( ingChoiceN ~ neighAveInSE.Z * novel * inDegree.Z + desirability.Z + ( neighAveInSE.Z + novel | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Backwards solution: Can you predict self-evaluations from similarity to ingroup and outgroup choices?

## Main effect

```{r}
m <- lmer( scale(selfResp) ~ scale(inGsim) + scale(outGsim) + (  scale(inGsim) + scale(outGsim) | subID) + (1 | trait), data = fullTrain)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "B", string.se = "SE", string.stat = "t", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## Moderated by condition

```{r}
m <- lmer( scale(selfResp) ~ scale(inGsim)*outgroup + scale(outGsim)*outgroup + (  scale(inGsim) + scale(outGsim) | subID) + ( outgroup | trait), data = fullTrain)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "B", string.se = "SE", string.stat = "t", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("inGsim","outgroup")) %>% plot(show.title=F) + xlab("Similarity to Ingroup Choices") + ylab("Self-Evaluation") + jtools::theme_apa()
```

## Metacontrast Ratio Moderated by Condition

```{r}
m <- lmer( scale(selfResp) ~ scale(metaContrast)*outgroup + scale(desirability) + (  scale(inGsim) + scale(metaContrast) | subID) + ( 1 | trait), data = fullTrain)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "B", string.se = "SE", string.stat = "t", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("metaContrast","outgroup")) %>% plot(show.title=F) + xlab("Similarity to Ingroup Choices") + ylab("Self-Evaluation") + jtools::theme_apa()

fullTrain$outgroupOrder <- factor(fullTrain$outgroup, levels = c("Not UCR", "CSU LA", "UCLA"), ordered = T)
m <- lmer( scale(selfResp) ~ scale(metaContrast)*outgroupOrder + (  scale(inGsim) + scale(metaContrast) | subID) + ( 1 | trait), data = fullTrain)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "B", string.se = "SE", string.stat = "t", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("metaContrast","outgroupOrder")) %>% plot(show.title=F) + xlab("Similarity to Ingroup Choices") + ylab("Self-Evaluation") + jtools::theme_apa()
```


## Moderated by Group Homophily

People who mentally segregrate the groups also self-evaluate more similar to their later group choices.

```{r}
# m <- lmer( scale(selfResp) ~ scale(inGsim) * scale(groupHomoph) + scale(outGsim) + (  scale(inGsim) + scale(outGsim) | subID) + (1 | trait), data = fullTrain)
# summary(m)
# tidy(m,conf.int=TRUE,effects="fixed")
# ggpredict(m, c("inGsim","groupHomoph")) %>% plot(show.title=F) + xlab("Similarity to Ingroup Choices") + ylab("Self-Evaluation") + jtools::theme_apa()
```

# Individual differences moderation of self-anchoring

## More self-projection for those who perceive group as more entitative?

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * Ent.Z + ( WSR.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## More self-projection for those who have been at UCR for shorter time?

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * Years + ( WSR.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

## More self-projection for higher self-esteem?

Higher self-esteem people self-project more

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * SE + ( WSR.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
ggpredict(m, c("SE","WSR.Z")) %>% plot(show.title=F) + xlab("Self-Esteem") + ylab("Self-Evaluation") + jtools::theme_apa()
```

# Do people higher in social identification self-project more?

No evidence

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * MGIS + ( WSR.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Do people higher in need for cognition self-project more?

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * NFC + ( WSR.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Do people higher in need to belong project more?

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * NTB + ( WSR.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```

# Do people higher in self-prototypicality self-project more?

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * Proto + ( WSR.Z | subID) + (1 | trait), data = fullTest, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
tab_model(m, collapse.ci = T, show.stat=T, show.r2 = T, show.se = T, string.pred = c("Fixed Effects"), string.est = "OR", string.se = "SE", string.stat = "z", digits = 3, emph.p = F, dv.labels = "Ingroup Prediction")
```
