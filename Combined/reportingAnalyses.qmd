---
title: "SelfAnchoring"
format: 
  html:
    toc: true
    html-math-method: katex
    css: styles.css
editor: visual
---

```{r, include=F}
#library(groundhog)
library(pacman)

# pkgs <-  c("lmerTest", "ggeffects","r2glmm", "tidyverse","here", "sjPlot", "ggpubr", "wesanderson", "effectsize","broom.mixed","corrr","report", "ez", "ggdist", "gtsummary")
# groundhog.day <- '2023-03-02'
# groundhog.library(pkgs, groundhog.day)

pacman::p_load("lmerTest", "ggeffects","r2glmm", "tidyverse","here", "sjPlot", "ggpubr", "wesanderson", "effectsize","broom.mixed","corrr","report", "ez", "ggdist", "gtsummary","brms","kableExtra","bayestestR","ordbetareg")

here::i_am("Combined/reportingAnalyses.qmd")

devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/corToOne.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/plotCommAxes.R")
devtools::source_url("https://raw.githubusercontent.com/JacobElder/MiscellaneousR/master/named.effects.ref.R")
```

Workspace

```{r}
load("/Volumes/Research Project/Self-Anchoring/Combined/Combined/reportingAnalysesEnv.RData")
save.image("/Volumes/Research Project/Self-Anchoring/Combined/Combined/reportingAnalysesEnv.RData")
```

# Study 1

```{r, include=F}
fullTest1 <- arrow::read_parquet(here("Study 1//Cleaning/output/fullTest.parquet"))
fullTrain1 <- arrow::read_parquet(here("Study 1/Cleaning/output/fullTrain.parquet"))

traitsFreqs1 <- read.csv(here("Study 1//Cleaning/output/traitFreqOverUnder.csv"))

uSubs <- unique(fullTest1$subID)

indDiffs1 <- fullTest1[!duplicated(fullTest1$subID),]
indDiffs1 <- indDiffs1 %>% select(subID, groupHomoph, DS:SING.Inter)
```

```{r, include=F}
fullTest1$ingChoiceN <- as.factor(fullTest1$ingChoiceN)
fullTest1$novel <- as.factor(fullTest1$novel)
fullTest1$selfResp.Z <- as.numeric(scale(fullTest1$selfResp)[,1])
fullTest1$SE.Z <- as.numeric(scale(fullTest1$SE)[,1])
fullTest1$iSE.Z <- as.numeric(scale(fullTest1$iSE)[,1])
fullTest1$oSE.Z <- as.numeric(scale(fullTest1$oSE)[,1])
fullTest1$predicted.Z <- as.numeric(scale(fullTest1$predicted)[,1])
fullTest1$slope.Z <- as.numeric(scale(fullTest1$slope)[,1])
fullTest1$entropy.Z <- as.numeric(scale(fullTest1$entropy)[,1])
fullTest1$WSR.Z <- as.numeric(scale(fullTest1$WSR)[,1])
fullTest1$neighAveOutSE.Z <- as.numeric(scale(fullTest1$neighAveOutSE)[,1])
fullTest1$neighAveAllSE.Z <- as.numeric(scale(fullTest1$neighAveAllSE)[,1])
fullTest1$neighAveInSE.Z <- as.numeric(scale(fullTest1$neighAveInSE)[,1])
fullTest1$evalLOO.Z <- as.numeric(scale(fullTest1$evalLOO)[,1])
fullTest1$propCorrLOO.Z <- as.numeric(scale(fullTest1$propCorrLOO)[,1])
fullTest1$propCorr.Z <- as.numeric(scale(fullTest1$propCorr)[,1])
fullTest1$desirability.Z <- as.numeric(scale(fullTest1$desirability)[,1])
fullTest1$er.Z <- as.numeric(scale(fullTest1$er)[,1])
fullTest1$outDegree.Z <- as.numeric(scale(fullTest1$outDegree)[,1])
fullTest1$inDegree.Z <- as.numeric(scale(fullTest1$inDegree)[,1])

fullTest1$novel <- as.factor(fullTest1$novel)
levels(fullTest1$novel) <- list("Trained"  = "0", "Held Out" = "1")

fullTrain1$metaContrastS <- log(fullTrain1$metaContrastS)
fullTrain1$metaContrastS.Z <- as.numeric(scale(fullTrain1$metaContrastS)[,1])
fullTrain1$inGsimS.Z <- as.numeric(scale(fullTrain1$inGsimS)[,1])
fullTrain1$outGsimS.Z <- as.numeric(scale(fullTrain1$outGsimS)[,1])

ncores = parallel::detectCores()
options(mc.cores = parallel::detectCores())
```

## **People Classify Desirable Traits as Ingroup Characteristic**

```{r}
m1 <- glmer( ingChoiceN ~ desirability.Z +  ( desirability.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m1 %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )

DES.ING <-brm( ingChoiceN ~ desirability.Z + ( desirability.Z | subID) + (1 | trait), data=fullTest1, cores=ncores, family = bernoulli(link = "logit") )
sexit(DES.ING) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

## **People Classify Self-Descriptive Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )

```

```{r}
SELF.ING <-brm( ingChoiceN ~ selfResp.Z +  ( selfResp.Z | subID) + ( 1 | trait), data=fullTest1, cores=ncores, family = bernoulli(link = "logit") )
sexit(SELF.ING) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

## **People Classify Similar-to-Self Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )

```

```{r}
WSR.ING <-brm( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data=fullTest1, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSR.ING) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Do people use similarity-to-self for novel traits?

No difference between novel and observed traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )

parameters::equivalence_test(m, rule = "cet")
```

```{r}
WSRNOV.ING <-brm( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data=fullTest1, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRNOV.ING) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
equivalence_test(WSRNOV.ING, rule = "bayes")
```

### Does effect of similarity-to-self differ depending on degree centrality?

No effect

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )

```

```{r}
WSROUT.ING <-brm( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data=fullTest1, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSROUT.ING) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

Small but nonsignificant differences for higher indegree traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSRIN.ING <-brm( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data=fullTest1, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRIN.ING) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

## **Projection to the Ingroup, Rather than Rejection of the Outgroup**

### Metacontrast ratio (summed similarity to ingroup over summed similarity to outgroup) is strongly associated with self-descriptiveness

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z  + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain1)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
MCS.SR <-brm( selfResp ~ metaContrastS.Z + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain1, cores=ncores, family = cumulative(link = "logit") )
sexit(MCS.SR) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### What are the relative contributions summed similarity to ingroup and summed similarity to outgroup?

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z + outGsimS.Z  + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain1)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
ISOS.SR <-brm( selfResp ~ inGsimS.Z + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain1, cores=ncores, family = cumulative(link = "logit") )
sexit(ISOS.SR) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

## Correlates of Homophily in Group Classifications

```{r}
indDiffs1 %>% select(groupHomoph, DS:SING.Ind) %>% corToOne(., "groupHomoph")
indDiffs1 %>% select(groupHomoph, DS:SING.Ind) %>% plotCorToOne(., "groupHomoph")
```

## Computational Model

TBD

### Model Performance

### Parameter Recovery

### Parameter Correlations with Individual Differences

# Study 2

```{r, include = F}
fullTest2 <- arrow::read_parquet(here("Study 2//Cleaning/output/fullTest.parquet"))
fullTrain2 <- arrow::read_parquet(here("Study 2/Cleaning/output/fullTrain.parquet"))

traitsFreqs1 <- read.csv(here("Study 2//Cleaning/output/traitFreqOverUnder.csv"))

uSubs <- unique(fullTest2$subID)

indDiffs2 <- fullTest2[!duplicated(fullTest2$subID),]
```

```{r, include = F}
fullTest2$ingChoiceN <- as.factor(fullTest2$ingChoiceN)
fullTest2$novel <- as.factor(fullTest2$novel)
fullTest2$selfResp.Z <- as.numeric(scale(fullTest2$selfResp)[,1])
fullTest2$SE.Z <- as.numeric(scale(fullTest2$SE)[,1])
fullTest2$iSE.Z <- as.numeric(scale(fullTest2$iSE)[,1])
fullTest2$oSE.Z <- as.numeric(scale(fullTest2$oSE)[,1])
fullTest2$predicted.Z <- as.numeric(scale(fullTest2$predicted)[,1])
fullTest2$slope.Z <- as.numeric(scale(fullTest2$slope)[,1])
fullTest2$entropy.Z <- as.numeric(scale(fullTest2$entropy)[,1])
fullTest2$WSR.Z <- as.numeric(scale(fullTest2$WSR)[,1])
fullTest2$neighAveOutSE.Z <- as.numeric(scale(fullTest2$neighAveOutSE)[,1])
fullTest2$neighAveAllSE.Z <- as.numeric(scale(fullTest2$neighAveAllSE)[,1])
fullTest2$neighAveInSE.Z <- as.numeric(scale(fullTest2$neighAveInSE)[,1])
fullTest2$evalLOO.Z <- as.numeric(scale(fullTest2$evalLOO)[,1])
fullTest2$desirability.Z <- as.numeric(scale(fullTest2$desirability)[,1])
fullTest2$er.Z <- as.numeric(scale(fullTest2$er)[,1])
fullTest2$outDegree.Z <- as.numeric(scale(fullTest2$outDegree)[,1])
fullTest2$inDegree.Z <- as.numeric(scale(fullTest2$inDegree)[,1])

fullTest2$novel <- as.factor(fullTest2$novel)
levels(fullTest2$novel) <- list("Trained"  = "0", "Held Out" = "1")

fullTrain2$metaContrastS <- (fullTrain2$inGsimS/fullTrain2$outGsimS)
fullTrain2$metaContrastS <- log(fullTrain2$metaContrastS)
fullTrain2$metaContrastS[is.infinite(fullTrain2$metaContrastS)] <- NA
fullTrain2$metaContrastS.Z <- as.numeric(scale(fullTrain2$metaContrastS)[,1])
fullTrain2$inGsimS.Z <- as.numeric(scale(fullTrain2$inGsimS)[,1])
fullTrain2$outGsimS.Z <- as.numeric(scale(fullTrain2$outGsimS)[,1])

fullTest2$outgroup <- as.factor(fullTest2$outgroup)
fullTest2$outgroup <- relevel(fullTest2$outgroup,"Not UCR")

fullTrain2$outgroup <- as.factor(fullTrain2$outgroup)
fullTrain2$outgroup <- relevel(fullTrain2$outgroup,"Not UCR")

fullTest2$outgroupE <- named.effects.ref(fullTest2$outgroup, "Not UCR")
```

## **Differences Across Univerisities in Perceived Warmth and Status**

### Warmth

```{r, echo=F}
warmthDf <- pivot_longer(indDiffs2, cols=starts_with("Therm_"), names_to="University", values_to="Warmth") %>% select(subID, University, Warmth) %>% drop_na()
warmthDf$University <- gsub("Therm_1","UCR", warmthDf$University)
warmthDf$University <- gsub("Therm_2","UCLA", warmthDf$University)
warmthDf$University <- gsub("Therm_4","CSU LA", warmthDf$University)

warmthDf$University <- as.factor(warmthDf$University)
warmthDf$subID <- as.factor(warmthDf$subID)
warmthDf$University <- relevel(warmthDf$University, ref = "UCR")
#warmthDf$University <- named.effects.ref(warmthDf$University, "UCR")
m <- lmer( scale(Warmth) ~ University +  ( 1  | subID), data = warmthDf)
summary(m)
ggpredict(m, c("University")) %>% plot()
```

```{r}
warmthDf$WarmthD <- warmthDf$Warmth/100
WARM.UNI <- ordbetareg(WarmthD ~ as.factor(University) +
                               (1|subID), 
                       data=warmthDf,
                cores=ncores)
sexit(WARM.UNI) %>% as_tibble %>% mutate(p = 2 * (1-Direction)) %>% kable()
psych::describeBy(warmthDf$WarmthD, warmthDf$University)
```

```{r}
m<-ezANOVA(warmthDf, dv = Warmth, wid = subID, between = as.factor(University) )
m

indDiffs2$groupHomoph.Z <- scale(indDiffs2$groupHomoph)
ggplot(warmthDf, aes(University, Warmth)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Warmth",x="University") + jtools::theme_apa()
```

### Status

```{r, echo=F}
indDiffs2$Status <- NULL
statusDf <- pivot_longer(indDiffs2, cols=ends_with("_Status"), names_to="University", values_to="Status") %>% select(subID, University, Status) %>% drop_na()
statusDf$University <- gsub("_Status","", statusDf$University)

statusDf$University <- as.factor(statusDf$University)
statusDf$subID <- as.factor(statusDf$subID)
statusDf$University <- relevel(statusDf$University, ref = "UCR")

m <- lmer( scale(Status) ~ University +  ( 1  | subID), data = statusDf)
summary(m)
ggpredict(m, c("University")) %>% plot()
```

```{r}
STAT.UNIV <-brm( Status ~ University + (  1 | subID), data = statusDf, cores=ncores, family = cumulative(link = "logit") )
sexit(STAT.UNIV) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
psych::describeBy(statusDf$Status, statusDf$University)
```

```{r}
m<-ezANOVA(statusDf, dv = Status, wid = subID, between = as.factor(University) )
m

ggplot(statusDf, aes(University, Status)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Status",x="University") + jtools::theme_apa()
```

## **People Classify Desirable Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ desirability.Z +  ( desirability.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
DES.ING.2 <-brm( ingChoiceN ~ desirability.Z + ( desirability.Z | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(DES.ING.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ desirability.Z * outgroup +  ( desirability.Z | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
DES.ING.COND.2 <-brm( ingChoiceN ~ desirability.Z * outgroup + ( desirability.Z | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(DES.ING.COND.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
ggpredict(DES.ING.COND.2, c("desirability.Z", "outgroup")) %>% plot()
```

## **People Classify Self-Descriptive Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
SR.ING.2 <-brm( ingChoiceN ~ selfResp.Z + ( selfResp.Z | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(SR.ING.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z * outgroup +  ( selfResp.Z | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
SR.ING.COND.2 <-brm( ingChoiceN ~ selfResp.Z * outgroup + ( selfResp.Z | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(SR.ING.COND.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
ggpredict(SR.ING.COND.2, c("selfResp.Z", "outgroup")) %>% plot()
```

## **People Classify Similar-to-Self Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSR.ING.2 <-brm( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSR.ING.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outgroup + ( WSR.Z | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSR.ING.COND.2 <- brm( ingChoiceN ~ WSR.Z * outgroup + ( WSR.Z | subID) + ( outgroup | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSR.ING.COND.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
ggpredict(WSR.ING.COND.2, c("WSR.Z", "outgroup")) %>% plot()
```

### Do people use similarity-to-self for novel traits?

No difference between novel and observed traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

```{r}
WSRNOV.ING.2 <-brm( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRNOV.ING.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
equivalence_test(WSRNOV.ING.2, rule = "bayes")
```

#### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel * outgroup + ( WSR.Z + novel | subID) + ( outgroup | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

```{r}
WSRNOV.ING.COND.2 <-brm( ingChoiceN ~ WSR.Z * novel * outgroup + ( WSR.Z + novel | subID) + ( outgroup | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRNOV.ING.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
equivalence_test(WSRNOV.ING.COND.2, rule = "bayes")
```

### Does effect of similarity-to-self differ depending on degree centrality?

No effect

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSROUT.ING.2 <-brm( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSROUT.ING.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

Small but nonsignificant differences for higher indegree traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data = fullTest2, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSRIN.ING.2 <-brm( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data=fullTest2, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRIN.ING.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

## **Projection to the Ingroup, Rather than Rejection of the Outgroup**

### Metacontrast ratio (summed similarity to ingroup over summed similarity to outgroup) is strongly associated with self-descriptiveness

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z  + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain2)
summary(m)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
MCS.SR.2 <-brm( selfResp ~ metaContrastS.Z + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain2, cores=ncores, family = cumulative(link = "logit") )
sexit(MCS.SR.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Metacontrast ratio compared across condition

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z * outgroup  + (  metaContrastS.Z | subID) + ( outgroup | trait), data = fullTrain2)
summary(m)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
MCS.SR.COND.2 <-brm( selfResp ~ metaContrastS.Z * outgroup + (  metaContrastS.Z | subID) + ( outgroup | trait), data = fullTrain2, cores=ncores, family = cumulative(link = "logit") )
sexit(MCS.SR.COND.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### What are the relative contributions summed similarity to ingroup and summed similarity to outgroup?

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * Therm_1 * outgroup + outGsimS.Z * Therm_1 * outgroup
           + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain2)
summary(m)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
ISOS.SR.2 <-brm( selfResp ~ inGsimS.Z + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain2, cores=ncores, family = cumulative(link = "logit") )
sexit(ISOS.SR.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Summed Similarity Compared Across Conditions

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * outgroup + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + ( outgroup | trait), data = fullTrain2)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
ISOS.SR.COND.2 <-brm( selfResp ~ inGsimS.Z * outgroup + outGsimS.Z * outgroup + (  inGsimS.Z + outGsimS.Z | subID) + ( outgroup | trait), data = fullTrain2, cores=ncores, family = cumulative(link = "logit") )
sexit(ISOS.SR.COND.2) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

## Correlates of Homophily in Group Classifications

```{r}
indDiffs2 %>% select(groupHomoph, seHomoph, SStatus:IdImp) %>% corToOne(., "groupHomoph")
indDiffs2 %>% select(groupHomoph, seHomoph, SStatus:IdImp) %>% plotCorToOne(., "groupHomoph")
```

## Computational Model

TBD

### Model Performance

### Parameter Recovery

### Parameter Correlations with Individual Differences

```{r}
save.image("/Volumes/Research Project/Self-Anchoring/Combined/Combined/reportingAnalysesEnv.RData")
```

# Study 3

```{r, include = F}
fullTest3 <- arrow::read_parquet(here("Study 3//Cleaning/output/fullTest.parquet"))
fullTrain3 <- arrow::read_parquet(here("Study 3/Cleaning/output/fullTrain.parquet"))

uSubs <- unique(fullTest3$subID)

indDiffs3 <- fullTest3[!duplicated(fullTest3$subID),]
```

```{r, include = F}
fullTest3$ingChoiceN <- as.factor(fullTest3$ingChoiceN)
fullTest3$novel <- as.factor(fullTest3$novel)
fullTest3$selfResp.Z <- as.numeric(scale(fullTest3$selfResp)[,1])
fullTest3$SE.Z <- as.numeric(scale(fullTest3$SE)[,1])
fullTest3$iSE.Z <- as.numeric(scale(fullTest3$iSE)[,1])
fullTest3$oSE.Z <- as.numeric(scale(fullTest3$oSE)[,1])
fullTest3$predicted.Z <- as.numeric(scale(fullTest3$predicted)[,1])
fullTest3$slope.Z <- as.numeric(scale(fullTest3$slope)[,1])
fullTest3$entropy.Z <- as.numeric(scale(fullTest3$entropy)[,1])
fullTest3$WSR.Z <- as.numeric(scale(fullTest3$WSR)[,1])
fullTest3$neighAveOutSE.Z <- as.numeric(scale(fullTest3$neighAveOutSE)[,1])
fullTest3$neighAveAllSE.Z <- as.numeric(scale(fullTest3$neighAveAllSE)[,1])
fullTest3$neighAveInSE.Z <- as.numeric(scale(fullTest3$neighAveInSE)[,1])
fullTest3$evalLOO.Z <- as.numeric(scale(fullTest3$evalLOO)[,1])
fullTest3$desirability.Z <- as.numeric(scale(fullTest3$desirability)[,1])
fullTest3$er.Z <- as.numeric(scale(fullTest3$er)[,1])
fullTest3$outDegree.Z <- as.numeric(scale(fullTest3$outDegree)[,1])
fullTest3$inDegree.Z <- as.numeric(scale(fullTest3$inDegree)[,1])

fullTest3$novel <- as.factor(fullTest3$novel)
levels(fullTest3$novel) <- list("Trained"  = "0", "Held Out" = "1")

fullTrain3$metaContrastS <- (fullTrain3$inGsimS/fullTrain3$outGsimS)
fullTrain3$metaContrastS <- log(fullTrain3$metaContrastS)
fullTrain3$metaContrastS[is.infinite(fullTrain3$metaContrastS)] <- NA
fullTrain3$metaContrastS.Z <- as.numeric(scale(fullTrain3$metaContrastS)[,1])
fullTrain3$inGsimS.Z <- as.numeric(scale(fullTrain3$inGsimS)[,1])
fullTrain3$outGsimS.Z <- as.numeric(scale(fullTrain3$outGsimS)[,1])

fullTest3$condition <- as.factor(fullTest3$condition)
fullTest3$condition <- relevel(fullTest3$condition,"Majority")

fullTrain3$condition <- as.factor(fullTrain3$condition)
fullTrain3$condition <- relevel(fullTrain3$condition,"Majority")
```

## **Differences Across Univerisities in Perceived Warmth and Status**

### Warmth

```{r, echo=F}
warmthDf <- pivot_longer(indDiffs3, cols=starts_with("Therm_"), names_to="Group", values_to="Warmth") %>% select(subID, Group, Warmth) %>% drop_na()
warmthDf$Group <- gsub("Therm_1","White", warmthDf$Group)
warmthDf$Group <- gsub("Therm_2","Asian", warmthDf$Group)
warmthDf$Group <- gsub("Therm_4","Latino", warmthDf$Group)

warmthDf$Group <- as.factor(warmthDf$Group)
warmthDf$subID <- as.factor(warmthDf$subID)
warmthDf$Group <- relevel(warmthDf$Group, ref = "White")

m <- lmer( scale(Warmth) ~ Group +  ( 1  | subID), data = warmthDf)
summary(m)
ggpredict(m, c("Group")) %>% plot()

m<-ezANOVA(warmthDf, dv = Warmth, wid = subID, between = as.factor(Group) )
m

ggplot(warmthDf, aes(Group, Warmth)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Warmth",x="University") + jtools::theme_apa()
```

```{r}
warmthDf$WarmthD <- warmthDf$Warmth/100
WARM.RACE <- ordbetareg(WarmthD ~ as.factor(Group) +
                               (1|subID), 
                       data=warmthDf,
                cores=ncores)
sexit(WARM.RACE) %>% as_tibble %>% mutate(p = 2 * (1-Direction)) %>% kable()
psych::describeBy(warmthDf$WarmthD, warmthDf$Group)
```

### Status

```{r, echo=F}
indDiffs3$Status <- NULL
statusDf <- pivot_longer(indDiffs3, cols=ends_with("_Status"), names_to="Group", values_to="Status") %>% select(subID, Group, Status) %>% drop_na()
statusDf$Group <- gsub("_Status","", statusDf$Group)

statusDf$Group <- as.factor(statusDf$Group)
statusDf$subID <- as.factor(statusDf$subID)
statusDf$Group <- relevel(statusDf$Group, ref = "White")

m <- lmer( scale(Status) ~ Group +  ( 1  | subID), data = statusDf)
summary(m)
ggpredict(m, c("Group")) %>% plot()

m<-ezANOVA(statusDf, dv = Status, wid = subID, between = as.factor(Group) )
m

ggplot(statusDf, aes(Group, Status)) + 
  ggdist::stat_halfeye(adjust = .5, width = .7, .width = 0, justification = -.2, point_colour = NA) + 
  geom_boxplot(width = .2, outlier.shape = NA) + 
  geom_jitter(width = .05, alpha = .3) + labs(y="Perceived Status",x="University") + jtools::theme_apa()
```

```{r}
STAT.GROUP <-brm( Status ~ Group + (  1 | subID), data = statusDf, cores=ncores, family = cumulative(link = "logit") )
sexit(STAT.GROUP) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
psych::describeBy(statusDf$Status, statusDf$Group)
```

## **People Classify Desirable Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ desirability.Z +  ( desirability.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
DES.ING.3 <-brm( ingChoiceN ~ desirability.Z + ( desirability.Z | subID) + ( 1 | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(DES.ING.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ desirability.Z * condition +  ( desirability.Z | subID) + ( condition | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
DES.ING.COND.3 <-brm( ingChoiceN ~ desirability.Z * condition + ( desirability.Z | subID) + ( condition | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(DES.ING.COND.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
ggpredict(DES.ING.COND.3, c("desirability.Z", "condition")) %>% plot()
```

## **People Classify Self-Descriptive Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z +  ( selfResp.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
SR.ING.3 <-brm( ingChoiceN ~ selfResp.Z + ( selfResp.Z | subID) + ( 1 | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(SR.ING.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ selfResp.Z * condition +  ( selfResp.Z | subID) + ( condition | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
SR.ING.COND.3 <-brm( ingChoiceN ~ selfResp.Z * condition + ( selfResp.Z | subID) + ( condition | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(SR.ING.COND.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
ggpredict(SR.ING.COND.3, c("selfResp.Z", "condition")) %>% plot()
```

## **People Classify Similar-to-Self Traits as Ingroup Characteristic**

```{r}
m <- glmer( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSR.ING.3 <-brm( ingChoiceN ~ WSR.Z + ( WSR.Z | subID) + ( 1 | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSR.ING.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * condition * MGIS + racid + ( 1 | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa"),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSR.ING.COND.3 <- brm( ingChoiceN ~ WSR.Z * condition + ( WSR.Z | subID) + ( condition | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSR.ING.COND.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
ggpredict(WSR.ING.COND.3, c("WSR.Z", "condition")) %>% plot()
```

```{r}
test <- brm( ingChoiceN ~ WSR.Z * condition + desirability + racid + ( WSR.Z | subID) + ( condition | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(test) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
ggpredict(test, c("WSR.Z", "condition")) %>% plot()
```

### Do people use similarity-to-self for novel traits?

No difference between novel and observed traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

```{r}
WSRNOV.ING.3 <-brm( ingChoiceN ~ WSR.Z * novel + ( WSR.Z + novel | subID) + ( 1 | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRNOV.ING.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
equivalence_test(WSRNOV.ING.3, rule = "bayes")
```

#### Compared across conditions

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * novel * condition + ( WSR.Z + novel | subID) + ( condition | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
parameters::equivalence_test(m)
```

```{r}
WSRNOV.ING.COND.3 <-brm( ingChoiceN ~ WSR.Z * novel * condition + ( WSR.Z + novel | subID) + ( condition | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRNOV.ING.COND.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
equivalence_test(WSRNOV.ING.COND.3, rule = "bayes")
```

### Does effect of similarity-to-self differ depending on degree centrality?

No effect

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data = fullTest1, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSROUT.ING.3 <-brm( ingChoiceN ~ WSR.Z * outDegree.Z + ( WSR.Z + outDegree.Z | subID) + ( 1 | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSROUT.ING.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

Small but nonsignificant differences for higher indegree traits

```{r}
m <- glmer( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data = fullTest3, family = binomial, control = glmerControl(optimizer = "bobyqa",
                                    optCtrl = list(maxfun = 100000)),
    nAGQ = 1)
m %>%
  tbl_regression(
    exponentiate = TRUE,
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
```

```{r}
WSRIN.ING.3 <-brm( ingChoiceN ~ WSR.Z * inDegree.Z + ( WSR.Z + inDegree.Z | subID) + ( 1 | trait), data=fullTest3, cores=ncores, family = bernoulli(link = "logit") )
sexit(WSRIN.ING.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

## **Projection to the Ingroup, Rather than Rejection of the Outgroup**

### Metacontrast ratio (summed similarity to ingroup over summed similarity to outgroup) is strongly associated with self-descriptiveness

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z  + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
MCS.SR.3 <-brm( selfResp ~ metaContrastS.Z + (  metaContrastS.Z | subID) + (1 | trait), data = fullTrain3, cores=ncores, family = cumulative(link = "logit") )
sexit(MCS.SR.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Metacontrast ratio compared across condition

```{r}
m <- lmer( scale(selfResp) ~ metaContrastS.Z * condition  + (  metaContrastS.Z | subID) + ( condition | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
MCS.SR.COND.3 <-brm( selfResp ~ metaContrastS.Z * condition + (  metaContrastS.Z | subID) + ( condition | trait), data = fullTrain3, cores=ncores, family = cumulative(link = "logit") )
sexit(MCS.SR.COND.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### What are the relative contributions summed similarity to ingroup and summed similarity to outgroup?

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * condition + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

### Summed Similarity to Ingroup Compared Across Conditions

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z * condition + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + ( outgroup | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
ISOS.SR.3 <-brm( selfResp ~ inGsimS.Z + outGsimS.Z + (  inGsimS.Z + outGsimS.Z | subID) + (1 | trait), data = fullTrain3, cores=ncores, family = cumulative(link = "logit") )
sexit(ISOS.SR.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

### Summed Similarity to Outgroup Compared Across Conditions

```{r}
m <- lmer( scale(selfResp) ~ inGsimS.Z + outGsimS.Z * condition + (  inGsimS.Z + outGsimS.Z | subID) + ( condition | trait), data = fullTrain3)
m %>%
  tbl_regression(
    pvalue_fun = ~ style_pvalue(.x, digits = 2),
  )
r2beta(m)
```

```{r}
ISOS.SR.COND.3 <-brm( selfResp ~ inGsimS.Z * condition + outGsimS.Z * condition + (  inGsimS.Z + outGsimS.Z | subID) + ( condition | trait), data = fullTrain3, cores=ncores, family = cumulative(link = "logit") )
sexit(ISOS.SR.COND.3) %>% as_tibble %>% mutate(OR = exp(Median), p = 2 * (1-Direction)) %>% kable()
```

```{r}
library(marginaleffects)
avg_comparisons(ISOS.SR.COND.3, variables = "outGsimS.Z", by = "condition")

avg_comparisons(ISOS.SR.COND.3, variables = c("outGsimS.Z", "condition"))
```

## Correlates of Homophily in Group Classifications

```{r}
indDiffs3 %>% select(groupHomoph, seHomoph, SStatus, SocClass, SCC:IdImp) %>% corToOne(., "groupHomoph")
indDiffs3 %>% select(groupHomoph, seHomoph, SStatus, SocClass, SCC:IdImp) %>% plotCorToOne(., "groupHomoph")
```

## Computational Model

TBD

### Model Performance

### Parameter Recovery

### Parameter Correlations with Individual Differences

# 

# Testing

```{r}
test(emmeans(WSR.ING.COND.2, pairwise ~outgroup*WSR.Z, at = list(WSR.Z = -1)))
test(emmeans(WSR.ING.COND.2, pairwise ~outgroup*WSR.Z, at = list(WSR.Z = 0)))
test(emmeans(WSR.ING.COND.2, pairwise ~outgroup*WSR.Z, at = list(WSR.Z = 1)))
```

```{r}
emmeans(WSR.ING.COND.2, specs = pairwise ~ WSR.Z*outgroup)
```

```{r}
library(marginaleffects)
test2 <- test
test2$data$outgroup <- as.character(test2$data$outgroup)
test3 <- avg_comparisons(test, variables = "WSR.Z", by = "outgroup")
test4 <- avg_comparisons(test, variables = "WSR.Z", by = "outgroup", hypothesis = "pairwise")
```
